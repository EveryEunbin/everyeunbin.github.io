<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>เปรียบเทียบราคาชมพู่ 2024 vs 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f4f7f6; padding: 20px; }
        .container { width: 90%; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; }
    </style>
</head>
<body>

<div class="container">
    <h2>กราฟเปรียบเทียบราคาชมพู่รายปี (2024 vs 2025)</h2>
    <canvas id="roseAppleChart"></canvas>
</div>

<script>
    // ฟังก์ชันช่วยจัดการวันที่ให้เหลือแค่ เดือน/วัน
    function formatMD(dateStr) {
        const d = new Date(dateStr);
        return `${d.getMonth() + 1}/${d.getDate()}`;
    }

    Papa.parse("rose2425.csv", {
        download: true,
        header: true,
        complete: function(results) {
            const rawData = results.data;
            
            // แยกข้อมูลตามปี
            const data2024 = rawData.filter(d => d.date && d.date.startsWith('2024'));
            const data2025 = rawData.filter(d => d.date && d.date.startsWith('2025'));

            // สร้าง Label แกน X (เอาวันที่ของปีที่มีข้อมูลเยอะกว่าเป็นเกณฑ์)
            const labels = data2024.map(d => formatMD(d.date));

            const ctx = document.getElementById('roseAppleChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '2025 (สูง)',
                            data: data2025.map(d => d.upper),
                            borderColor: '#e74c3c',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            pointRadius: 1
                        },
                        {
                            label: '2025 (ต่ำ)',
                            data: data2025.map(d => d.lower),
                            borderColor: '#e74c3c',
                            borderDash: [5, 5],
                            backgroundColor: 'transparent',
                            borderWidth: 1.5,
                            pointRadius: 0
                        },
                        {
                            label: '2024 (สูง)',
                            data: data2024.map(d => d.upper),
                            borderColor: '#3498db',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            pointRadius: 1
                        },
                        {
                            label: '2024 (ต่ำ)',
                            data: data2024.map(d => d.lower),
                            borderColor: '#3498db',
                            borderDash: [5, 5],
                            backgroundColor: 'transparent',
                            borderWidth: 1.5,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { title: { display: true, text: 'ราคา (บาท)' } },
                        x: { title: { display: true, text: 'วัน/เดือน' } }
                    },
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
    });
</script>

</body>
</html>
